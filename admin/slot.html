<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>Scrapman Admin</title>
  <!-- plugins:css -->
  <link rel="stylesheet" href="vendors/mdi/css/materialdesignicons.min.css">
  <link rel="stylesheet" href="vendors/base/vendor.bundle.base.css">
  <!-- endinject -->
  <!-- plugin css for this page -->
  <link rel="stylesheet" href="vendors/datatables.net-bs4/dataTables.bootstrap4.css">
  <!-- End plugin css for this page -->
  <!-- inject:css -->
  <link rel="stylesheet" href="css/style.css">
  <!-- endinject -->
  <link rel="shortcut icon" href="images/favicon.png" />





  
</head>
<body>
  <nav class="navbar col-lg-12 col-12 p-0 fixed-top d-flex flex-row">
    <div class="navbar-brand-wrapper d-flex justify-content-center">
      <div class="navbar-brand-inner-wrapper d-flex justify-content-between align-items-center w-100">  
        <p class="h3" href="index.html">Scrapman</p>
        <button class="navbar-toggler navbar-toggler align-self-center" type="button" data-toggle="minimize">
          <span class="mdi mdi-sort-variant"></span>
        </button>
      </div>  
    </div>
    <div class="navbar-menu-wrapper d-flex align-items-center justify-content-end">
      <ul class="navbar-nav navbar-nav-right">
       
        
        <li class="nav-item nav-profile dropdown">
          <a class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown" id="profileDropdown">
            
            <span class="nav-profile-name">Admin</span>
          </a>
          <div class="dropdown-menu dropdown-menu-right navbar-dropdown" aria-labelledby="profileDropdown">
            <a class="dropdown-item">
              <i class="mdi mdi-settings text-primary"></i>
              Settings
            </a>
            <a class="dropdown-item" id="logout">
              <i class="mdi mdi-logout text-primary"></i>
              Logout
            </a>
          </div>
        </li>
      </ul>
      <button class="navbar-toggler navbar-toggler-right d-lg-none align-self-center" type="button" data-toggle="offcanvas">
        <span class="mdi mdi-menu"></span>
      </button>
    </div>
  </nav>
    <!-- partial -->
    <div class="container-fluid page-body-wrapper">
      <!-- partial:partials/_sidebar.html -->
      <nav class="sidebar sidebar-offcanvas" id="sidebar">
        <ul class="nav">
          <li class="nav-item">
            <a class="nav-link" href="index.html">
              <i class="mdi mdi-home menu-icon"></i>
              <span class="menu-title">Dashboard</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="basic-table.html">
              <i class="mdi mdi-home menu-icon"></i>
              <span class="menu-title">All Tables</span>
            </a>
          </li>

          <li class="nav-item">
            <a class="nav-link" href="slot.html">
              <i class="mdi mdi-grid-large menu-icon"></i>
              <span class="menu-title">Schedule Slot</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="items.html">
              <i class="mdi mdi-grid-large menu-icon"></i>
              <span class="menu-title">All Items</span>
            </a>
          </li>
      </nav>
      <!-- partial -->
      <div class="main-panel">
        <div class="content-wrapper">
          
          <div class="row">
            <div class="col-md-12 grid-margin">
              <div class="d-flex justify-content-between flex-wrap">
                <div class="d-flex align-items-end flex-wrap">
                  <div class="me-md-3 me-xl-5">
                    <h2>Scrapman Admin</h2>
                    <p class="mb-md-0">Analytics dashboard</p>
                  </div>
                  <div class="d-flex">
                    <i class="mdi mdi-home text-muted hover-cursor"></i>
                    <p class="text-muted mb-0 hover-cursor">&nbsp;/&nbsp;Dashboard&nbsp;/&nbsp;</p>
                    <p class="text-primary mb-0 hover-cursor">Analytics</p>
                  </div>
                </div>
                <div class="d-flex justify-content-between align-items-end flex-wrap">
                  
                  <button class="btn btn-primary btn-rounded btn-fw">Schedule Slot</button>
                </div>
              </div>
            </div>
          </div>
        <div class="container w-75 shadow-sm p-3 mb-5 bg-body rounded">
        <!-- <form action="" id="form"> -->
          <div class="row">
            <div class="col">
              <div class="card shadow p-3 mb-5 bg-body rounded">
                <div class="card-body">
                  <h5 class="card-title">Select Date</h5>                  
                  <input name="dateofjourney" type="date" class="form-control" id="date" required="required">
                </div>
              </div>
            </div>
            <div class="col">
              <div class="card shadow p-3 mb-5 bg-body rounded">
                <div class="card-body">
                  <h5 class="card-title">Select Time</h5>                 
                  <input name="dep_time" type="time" class="form-control" id="time" required="required">
                </div>
              </div>
            </div>
            <!-- <div class="col-sm-2">
                <div class="card-body text-center">                                  
                  <button class="btn btn-info btn-rounded btn-fw" onclick="add()">Add Slot</button>
                </div>
            </div> -->
            <div class="card-body text-center">                                  
              <button type="button" class="btn btn-success" onclick="add()">Add Slot</button>
            </div>
          </div>
          
        <!-- </form>  -->
        </div>
        <div class="container w-75 p-3 mb-5 bg-body rounded">
          <table class="table table-bordered table-hover container w-75 text-center shadow-sm p-3 mb-5 bg-body rounded" id="table">
            <thead class="">
              <tr>
                <th scope="col">Sl No.</th>
                
                <th scope="col">Date</th>
                <th scope="col">Time</th>
                <th scope="col">Edit</th>                
              </tr>
            </thead>
            
          </table>
      </div>
          
      <!-- main-panel ends -->
    </div>
    <!-- page-body-wrapper ends -->
  </div>
  <!-- container-scroller -->

  <!-- plugins:js -->
  <script src="vendors/base/vendor.bundle.base.js"></script>
  <!-- endinject -->
  <!-- Plugin js for this page-->
  <script src="vendors/chart.js/Chart.min.js"></script>
  <script src="vendors/datatables.net/jquery.dataTables.js"></script>
  <script src="vendors/datatables.net-bs4/dataTables.bootstrap4.js"></script>
  <!-- End plugin js for this page-->
  <!-- inject:js -->
  <script src="js/off-canvas.js"></script>
  <script src="js/hoverable-collapse.js"></script>
  <script src="js/template.js"></script>
  <!-- endinject -->
  <!-- Custom js for this page-->
  <script src="js/dashboard.js"></script>
  <script src="js/data-table.js"></script>
  <script src="js/jquery.dataTables.js"></script>
  <script src="js/dataTables.bootstrap4.js"></script>
  <!-- End custom js for this page-->  
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="js/jquery.cookie.js" type="text/javascript"></script>
  <script src="js/jquery.min.js" type="text/javascript"></script>
<script src="js/jquery.dataTables.min.js" type="text/javascript"></script>

<script>

// Login Check --------------------------------
login_check(); 

function login_check(){
      if (sessionStorage.getItem('token') === null) {
        window.location.href=("login.html");
      } else {
        console.log("Login Success");
      };
  };



const token = sessionStorage.getItem('token');
// Logout -------------------------------
$('#logout').on('click', function(){
  window.sessionStorage.clear();
    window.location.href = "login.html";
});


$(document).ready(function() {
    slots();
});

function refresh(){
  $(document).ready(function() {
    window.location.reload();
});
}

function add(){
        const date = document.getElementById('date');
        const time = document.getElementById('time');
        // Extract Time format -----
        const x = date.value;
        const dates= x.substring(8,10);
        const month= x.substring(5,7);
        const year= x.substring(0,4);
        const fdate = dates+"-"+month+"-"+year;
        
        let reqBody = {"date":fdate.toString(),"time":(time.value).toString()}      
        console.log({"date":fdate.toString(),"time":(time.value)});  
        
        const url = "http://localhost:5000/api/slot/create";
        fetch(url, {
          method: "POST",
          headers: {
            Accept: "application/json, text/plain, */*",
            "Content-Type": "application/json",
            'Authorization': 'Bearer '+sessionStorage.getItem('token')},
          body: JSON.stringify({
            date: fdate.toString(),
            time: (time.value).toString(),
          }),
          }).then((response) => response.json())
          .then((data) => {
            console.log(data);
            alert(data.msg);
            })
      }

// Display Available Slots -----------------------------------------------------------
function slots(){
    $.ajax({
    method:'get',    
    url:'http://localhost:5000/api/slot/getAll',
    headers:{
    'Authorization': 'Bearer '+sessionStorage.getItem('token')
    },success:function(response, code){   
      var slots = document.getElementById("table");
      for (var i = 0; i < response.length; i++){
        var row = `<tr>
                    <td>${i+1}</td>                    
                    <td>${response[i].date}</td>
                    <td>${response[i].time}</td>
                    <th><a role="button" onclick="delete_slot('${response[i]._id}')" class="btn btn-inverse-info btn-fw"> Delete </a></th>
                  </tr>`
          slots.innerHTML += row
          }
    }
  });
  
}

function delete_slot(id){
  const delete_url = "http://localhost:5000/api/slot/deleteSlot?id="+id;
        fetch(delete_url, {
          method: "POST",
          headers: {
            Accept: "application/json, text/plain, */*",
            "Content-Type": "application/json",
            'Authorization': 'Bearer '+token,
              },
          }).then((response) => response.json())
          .then((data) => {
            window.location.reload();
            console.log(data)});
  }
  </script>
</body>

</html>

